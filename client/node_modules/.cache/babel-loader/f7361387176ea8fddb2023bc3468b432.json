{"ast":null,"code":"var _jsxFileName = \"/Users/derektam/Documents/strava-client/src/components/HandleRedirect/index.js\";\nimport React from \"react\";\nimport { useCookies } from \"react-cookie\";\nimport { Redirect } from \"react-router-dom\";\n\nlet setTokensFromUrl = async () => {\n  const search = window.location.search.substring(1);\n  console.log(search);\n\n  if (!search) {\n    getNewAccessToken();\n    return;\n  }\n\n  const query = JSON.parse('{\"' + decodeURI(search).replace(/\"/g, '\\\\\"').replace(/&/g, '\",\"').replace(/=/g, '\":\"') + '\"}');\n  console.log(\"Query\", query);\n  let tokens;\n\n  if (query.code) {\n    tokens = fetch(`https://www.strava.com/oauth/token?client_id=41833&client_secret=3017d913766ccf81c8d716c0a40a961b35488aea&code=${query.code}&grant_type=authorization_code`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    }).then(response => response.json()).then(data => {\n      console.log(\"Success:\", data);\n      return {\n        accessToken: data.access_token,\n        refreshToken: data.refresh_token,\n        expiresAt: data.expires_at\n      };\n    }).catch(error => {\n      console.error(\"Error:\", error);\n    });\n  }\n\n  return tokens;\n};\n\nconst getNewAccessToken = () => {\n  const newTokens = fetch(`https://www.strava.com/oauth/token?client_id=41833&client_secret=3017d913766ccf81c8d716c0a40a961b35488aea&refresh_token=${refresh_token}&grant_type=refresh_token`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    }\n  });\n  console.log(newTokens);\n};\n\nconst HandleRedirect = () => {\n  const [cookies, setCookie] = useCookies([]);\n  React.useEffect(() => {\n    setTokensFromUrl().then(value => {\n      if (!value) {\n        return;\n      }\n\n      setCookie(\"access_token\", value.accessToken, {\n        path: \"/\",\n        maxAge: 604800\n      });\n      setCookie(\"refresh_token\", value.refreshToken, {\n        path: \"/\",\n        maxAge: 604800\n      });\n      setCookie(\"expires_at\", value.expiresAt, {\n        path: \"/\",\n        maxAge: 604800\n      });\n    });\n  }, []);\n  console.log(\"Cookies\", cookies);\n  const currentTime = Date.now() / 1000;\n  console.log(currentTime);\n  console.log(Number(cookies.expires_at));\n  console.log(cookies.expires_at > currentTime);\n\n  if (Number(cookies.expires_at) > currentTime) {\n    console.log(\"needs refresh\");\n    return;\n  }\n\n  return React.createElement(Redirect, {\n    to: \"/\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92\n    },\n    __self: this\n  });\n};\n\nexport default HandleRedirect;","map":{"version":3,"sources":["/Users/derektam/Documents/strava-client/src/components/HandleRedirect/index.js"],"names":["React","useCookies","Redirect","setTokensFromUrl","search","window","location","substring","console","log","getNewAccessToken","query","JSON","parse","decodeURI","replace","tokens","code","fetch","method","headers","then","response","json","data","accessToken","access_token","refreshToken","refresh_token","expiresAt","expires_at","catch","error","newTokens","HandleRedirect","cookies","setCookie","useEffect","value","path","maxAge","currentTime","Date","now","Number"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { useCookies } from \"react-cookie\";\nimport { Redirect } from \"react-router-dom\";\n\nlet setTokensFromUrl = async () => {\n  const search = window.location.search.substring(1);\n  console.log(search);\n  if (!search) {\n    getNewAccessToken();\n    return;\n  }\n  const query = JSON.parse(\n    '{\"' +\n      decodeURI(search)\n        .replace(/\"/g, '\\\\\"')\n        .replace(/&/g, '\",\"')\n        .replace(/=/g, '\":\"') +\n      '\"}'\n  );\n  console.log(\"Query\", query);\n  let tokens;\n  if (query.code) {\n    tokens = fetch(\n      `https://www.strava.com/oauth/token?client_id=41833&client_secret=3017d913766ccf81c8d716c0a40a961b35488aea&code=${query.code}&grant_type=authorization_code`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      }\n    )\n      .then(response => response.json())\n      .then(data => {\n        console.log(\"Success:\", data);\n        return {\n          accessToken: data.access_token,\n          refreshToken: data.refresh_token,\n          expiresAt: data.expires_at\n        };\n      })\n      .catch(error => {\n        console.error(\"Error:\", error);\n      });\n  }\n  return tokens;\n};\n\nconst getNewAccessToken = () => {\n  const newTokens = fetch(\n    `https://www.strava.com/oauth/token?client_id=41833&client_secret=3017d913766ccf81c8d716c0a40a961b35488aea&refresh_token=${refresh_token}&grant_type=refresh_token`,\n    {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    }\n  );\n  console.log(newTokens);\n};\n\nconst HandleRedirect = () => {\n  const [cookies, setCookie] = useCookies([]);\n  React.useEffect(() => {\n    setTokensFromUrl().then(value => {\n      if (!value) {\n        return;\n      }\n      setCookie(\"access_token\", value.accessToken, {\n        path: \"/\",\n        maxAge: 604800\n      });\n      setCookie(\"refresh_token\", value.refreshToken, {\n        path: \"/\",\n        maxAge: 604800\n      });\n      setCookie(\"expires_at\", value.expiresAt, {\n        path: \"/\",\n        maxAge: 604800\n      });\n    });\n  }, []);\n  console.log(\"Cookies\", cookies);\n\n  const currentTime = Date.now() / 1000;\n  console.log(currentTime);\n  console.log(Number(cookies.expires_at));\n  console.log(cookies.expires_at > currentTime);\n  if (Number(cookies.expires_at) > currentTime) {\n    console.log(\"needs refresh\");\n    return;\n  }\n  return <Redirect to=\"/\"></Redirect>;\n};\n\nexport default HandleRedirect;\n"]},"metadata":{},"sourceType":"module"}